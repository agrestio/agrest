<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title xmlns:d="http://docbook.org/ns/docbook">Chapter&nbsp;12.&nbsp;Writing Resource Endpoints</title><link rel="stylesheet" type="text/css" href="css/doc.css"><meta xmlns:d="http://docbook.org/ns/docbook" name="keywords" content="LinkRest documentation LinkRest docs"><meta xmlns:d="http://docbook.org/ns/docbook" name="description" content="LinkRest user documentation, version 1"><link rel="home" href="index.html" title="LinkRest Documentation"><link rel="up" href="framework.html" title="Part&nbsp;III.&nbsp;LinkRest Framework"><link rel="prev" href="framework-getting-started.html" title="Chapter&nbsp;11.&nbsp;Getting Started"><link rel="next" href="framework-chains.html" title="Chapter&nbsp;13.&nbsp;Request Chains"><script xmlns:d="http://docbook.org/ns/docbook" type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67243676-1', 'auto');
  ga('send', 'pageview');
        </script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:d="http://docbook.org/ns/docbook" class="navheader"><table width="100%" summary="Navigation header"><tr><th class="versioninfo">v.1 (1.22-SNAPSHOT)</th><th align="center">Chapter&nbsp;12.&nbsp;Writing Resource Endpoints</th><th></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="framework-getting-started.html">Prev</a>&nbsp;</td><th width="60%" align="center"><a accesskey="u" href="framework.html">Part&nbsp;III.&nbsp;LinkRest Framework</a></th><td width="20%" align="right">&nbsp;<a accesskey="n" href="framework-chains.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter&nbsp;12.&nbsp;Writing Resource Endpoints"><div class="titlepage"><div><div><h2 class="title"><a name="framework-programming-endpoints"></a>Chapter&nbsp;12.&nbsp;Writing Resource Endpoints</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="framework-programming-endpoints.html#framework-endpoints-post">Create Entity with POST</a></span></dt><dt><span class="section"><a href="framework-programming-endpoints.html#framework-endpoints-get">Read Collection of Entities with GET</a></span></dt><dt><span class="section"><a href="framework-programming-endpoints.html#framework-endpoints-get-one">Read a Single Entity with GET</a></span></dt></dl></div><p>Let's create a resource class called DomainResource, annotated with JAX-RS @Path and
            @Produces annotations. One extra thing we need for LinkRest to work is a an instance of
                <code class="code">javax.ws.rs.core.Configuration</code>, that can be injected with
                <code class="code">@Context</code>
            annotation:</p><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> javax.ws.rs.Path;
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> javax.ws.rs.Produces;
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> javax.ws.rs.core.Configuration;
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> javax.ws.rs.core.Context;

<span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@Path("domain")</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@Produces(MediaType.APPLICATION_JSON)</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</span> DomainResource {

    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@Context</span>
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">private</span> Configuration config;
}</pre><div class="section" title="Create Entity with POST"><div class="titlepage"><div><div><h2 class="title"><a name="framework-endpoints-post"></a>Create Entity with POST</h2></div></div></div><p>Now let's implement a <code class="code">POST</code> method in DomainResource
                class:</p><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> com.nhl.link.rest.LinkRest;
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> com.nhl.link.rest.SimpleResponse;

...

<span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@POST</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</span> SimpleResponse create(String data) {
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</span> LinkRest.create(Domain.<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</span>, config).sync(data);
}</pre><p>Here
                we've built a very simple "create chain" using LinkRest fluent API. It starts with a
                static "create" method on LinkRest class, taking a type of entity to create (Domain) and
                previously injected Configuration. Finally it calls "sync" method to execute the
                request. "data" String is expected to be an "Update Document" (see <a class="xref" href="protocol-json-documents.html#protocol-update-document" title="Request: Update Document">the section called &#8220;Request: Update Document&#8221;</a>), i.e. a single object or an array of objects.
                Now if you compile your app and deploy it in a web container (e.g. Tomcat), you may call
                this endpoint to create new Domain
                objects:</p><pre class="programlisting">curl -i -X POST 'http://example.org/myapp/domain' \
&gt;          -d '{"vhost":"mysite1.example.org","name":"My Site #1"}'

HTTP/1.1 201 Created
Content-Type: application/json

{"success":true}</pre><p>In your container log you might see output from Cayenne, actually inserting a newly
                created
                object:</p><pre class="programlisting">INFO CommonsJdbcEventLogger - INSERT INTO "domain" ("name", "vhost") VALUES (?, ?)
INFO CommonsJdbcEventLogger - [bind: 1-&gt;name:'My Site #1', 2-&gt;vhost:'mysite1.example.org']
INFO CommonsJdbcEventLogger - Generated PK: domain.id = 1
INFO CommonsJdbcEventLogger - === updated 1 row.</pre></div><div class="section" title="Read Collection of Entities with GET"><div class="titlepage"><div><div><h2 class="title"><a name="framework-endpoints-get"></a>Read Collection of Entities with GET</h2></div></div></div><p>You may create more Domain objects, executing <code class="code">POST</code> request above. Now
            let's write a <code class="code">GET</code> method to search for
            domains:</p><pre class="programlisting"><span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> com.nhl.link.rest.DataResponse;
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">import</span> com.nhl.link.rest.LinkRest;

...

<span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@GET</span>
<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">public</span> DataResponse&lt;Domain&gt; getAll(<span xmlns="http://www.w3.org/1999/xhtml" class="hl-annotation">@Context</span> UriInfo uriInfo) {
    <span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">return</span> LinkRest.select(Domain.<span xmlns="http://www.w3.org/1999/xhtml" class="hl-keyword">class</span>, config).uri(uriInfo).select();
}</pre><p>The above is a typical "select chain". Now <code class="code">GET</code> can be invoked from the
                client like
                this:</p><pre class="programlisting">curl -i -X GET 'http://example.org/myapp/domain'

HTTP/1.1 200 OK
Content-Type: application/json

{
    "data" : [
        { "id" : 1, "name" : "My Site #1", "vhost" : "mysite1.example.org" },
        { "id" : 2, "name" : "My Site #2", "vhost" : "mysite2.example.org" }
    ],
    "total" : 2
}</pre><p>Since
                select chain above incorporates UriInfo, it will recognize LinkRest control
                parameters passed from the client (see <a class="xref" href="protocol-control-parameters.html" title="Chapter&nbsp;8.&nbsp;Control Parameters">Chapter&nbsp;8, <i>Control Parameters</i></a>). Let's try using "cayenneExp" filter and
                "include":</p><pre class="programlisting">curl -i -X GET 'http://example.org/myapp/domain?cayenneExp=vhost="mysite1.example.org"&amp;include=id'

HTTP/1.1 200 OK
Content-Type: application/json

{
    "data" : [
        { "id" : 1 }
    ],
    "total" : 1
}</pre></div><div class="section" title="Read a Single Entity with GET"><div class="titlepage"><div><div><h2 class="title"><a name="framework-endpoints-get-one"></a>Read a Single Entity with GET</h2></div></div></div><p>A common request is to locate a single instance of an entity by ID. Here is how
                this can be done with
                LinkRest:</p><pre class="programlisting">@GET
@Path("{id}")
public DataResponse&lt;Domain&gt; getOne(@PathParam("id") int id, @Context UriInfo uriInfo) {
    return LinkRest.select(Domain.class, config).byId(id).uri(uriInfo).selectOne();
}</pre><p>Here
                we are binding "id" as a URL path parameter, but also notice that LinkRest doesn't
                mandate any specific place in the URL for ID. This is a decision made by the
                developer. Calling this endpoint, we'll get an expected
                result:</p><pre class="programlisting">curl -i -X GET 'http://example.org/myapp/domain/1'

HTTP/1.1 200 OK
Content-Type: application/json

{
    "data" : [
        { "id" : 1, "name" : "My Site #1", "vhost" : "mysite1.example.org" }
    ],
    "total" : 1
}</pre><p>Even
                though we expect at most one object to be returned, the response is the same
                Collection Document as we've seen before.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="framework-getting-started.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="framework.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="framework-chains.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;11.&nbsp;Getting Started&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;13.&nbsp;Request Chains</td></tr></table></div></body></html>